# HTTPRoute for forwarding /v1/chat/* traffic from MaaS gateway to Semantic Router
# This enables MaaS auth and rate limiting while providing vSR intelligent routing
#
# No path rewrite needed: /v1/chat/completions passes through directly
#
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: vsr-interim-route
  labels:
    app: semantic-router
    integration: maas
spec:
  parentRefs:
    - name: maas-default-gateway
      namespace: openshift-ingress
      sectionName: https
  hostnames:
    - "maas.${CLUSTER_DOMAIN}"
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /v1/chat
      filters:
        - type: RequestHeaderModifier
          requestHeaderModifier:
            remove:
              - x-vsr-destination-endpoint
              - x-selected-model
      backendRefs:
        - name: semantic-router-kserve
          namespace: ${VSR_NAMESPACE}
          port: 8801
